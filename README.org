* Introduction

These instructions are for setting up a privileged LXC container with
a Haskell development environment. The container runs Debian GNU/Linux
10 (code-named Buster). One can connect to the container via SSH and
VNC.

* Prerequisites

[[http://linuxcontainers.org/][LXC]] (Linux Containers) is a virtualization method specific to
operating systems based on the Linux kernel. Therefore, you need to
have a Linux-based operating system to follow these
instructions. Furthermore, the instructions are written for the
GNU/Linux Debian Buster operating system, though they should be
applicable to other GNU/Linux distributions (possibly with minor
modifications).


* Instructions

These are instructions for LXC 3.0.3 in Debian GNU/Linux Buster.

  1. To create a privileged container named "test-buster-1" with
     several things installed:
     : sudo lxc-create --name test-buster-1 --template debian -- --release buster --package sudo,emacs,xfonts-base,tightvncserver,xfce4,xfce4-goodies,haskell-platform,elpa-lsp-haskell,firefox-esr,xserver-xorg-core
  2. Start the container:
     : sudo lxc-start --name test-buster-1
  3. Set a password for the root user:
     : sudo lxc-attach --name test-buster-1 passwd
  4. Add a user =dev= to the container:
     : sudo lxc-attach --name test-buster-1 -- useradd -m -s /bin/bash dev
  5. Set the password for the =dev= user:
     : sudo lxc-attach --name test-buster-1 -- passwd dev
  6. Add =dev= to the =sudo= group for the root privileges:
     : sudo lxc-attach --name test-buster-1 -- usermod -a -G sudo dev
  7. (Something here is missing about =TTY=; it is resolved by adding
     the =dev= user via =visudo=).
  8. Copy the public SSH key of your user on the host machine to the
     =dev= user in the container:
     : ssh-copy-id -i ~/.ssh/id_rsa.pub dev@192.168.122.195
  9. Start the VNC server as the =dev= user:
     : sudo lxc-attach --name test-buster-1 -- su - dev -c vncserver
     This will ask for a password so create one.
  10. Kill the VNC server:
      : sudo lxc-attach --name test-buster-1 -- su - dev -c "vncserver -kill :1"
  11. Put the following in =~/.vnc/xstartup= in the container:
      #+BEGIN_SRC bash
	#!/bin/bash
	xrdb $HOME/.Xresources
	startxfce4 &
      #+END_SRC
  12. Start the VNC server again and set the screen resolution:
      : sudo lxc-attach --name test-buster-1 -- su - dev -c "vncserver -geometry 1920x1080"
  13. Start a VNC viewer on the host machine, e.g., GNOME's Remote
      Desktop Viewer. Provide the container's IP address and a port
      (the port is typically 5901).
* To be done
** TODO Add Keybase installation instructions
** TODO Decrease the display lag
   - Maybe there is something to configure in =/etc/X11= as generated
     by the =gtf= tool from the =xserver-xorg-core= package with
     ModeLine and a dummy driver.
* Copyright

To the extent possible under law, Marko Dimjašević has waived all
copyright and related or neighboring rights to this project ([[https://creativecommons.org/publicdomain/zero/1.0/][CC0]]).
